# Text

## 摘要

随着宽带技术以及物联网技术的发展，现在家庭中的智能设备越来越多，无线路由器、网络存储等设备愈加频繁的出现在我们的生活当中。很多这样的设备，其操作系统都是基于一套名为 OpenWrt 的基于 Linux 的嵌入式系统定制而来。该系统拥有开放源代码、兼容平台广泛、高度灵活可定制化等特点，受到很多厂商欢迎，但其构建过程较为繁琐，尤其对于产品研发团队内的部分非技术职位人员来说门槛过高，他们构建用于评估、测试等需求用的环境时会有诸多不便。

本文描述一套用于实现自动构建 OpenWrt 环境的工具，其功能包括自动更新、自动构建 OpenWrt 环境，并可通过基于 Web 的图形化界面对定制过程进行定制，以求降低构建评估测试环境时的繁琐程度。在介绍容器、Web 服务、虚拟化和版本控制工具等相关技术的基础上，探讨如何利用这些技术达到上述目的，并给出综合这些技术后的系统整体解决方案。

关键词：自动构建、容器、Web 服务

* 

## 1 绪论

### 1.1 研究背景和意义

随着宽带技术以及物联网技术的发展，现在家庭中的智能设备越来越多，不仅是很多电视、冰箱之类的白色家电都更多的加入了与网络连接的功能，更多样的工具比如扫地机器人、智能传感器等智能家居设备也越来越频繁的出现在我们的生活中。

很多这样的设备，其操作系统都是从一套名为 OpenWrt 的，基于 Linux 的嵌入式系统定制而来。该系统由包括 Linux 内核、opkg 包管理器、LuCI 管理界面、Busybox 等系统软件、以及一系列应用软件组合而成，兼容包括 Atheros、Qualcomm、MediaTek、BroadCom 等在内的绝大多数常见 SoC。其功能十分强大，且可以根据需求自由裁剪系统模块或增加特定功能；源代码完全开放，授权方式灵活，很多新的智能产品如小米、TP-Link、斐讯、水星等厂商的家庭用无线路由器，使用的都是基于 OpenWrt 深度定制并添加部分私有功能 / 驱动程序的操作系统。

OpenWrt 以上述一系列特点受到很多厂商青睐，使用 OpenWrt 开发智能设备使用的操作系统可以极大加快开发进度。但是产品研发的过程中涉及到一系列不同的参与者，对于部分不了解技术的团队成员来说需要降低他们实际参与开发活动的难度。

本文侧重于解决在基于 OpenWrt 进行项目开发时的一大难点：整体系统的构建。对于一个典型的 OpenWrt 项目，一般由 OpenWrt 原生组件（Linux 内核、LuCI 管理界面等）以及厂商编写的第三方软件（如智能流控、手机控制等）组合而成。测试人员进行测试时需要将需测试的组件或系统模块等的代码更新，然后再构建整个系统，构建完成之后将系统通过 TFTP 等方式烧写至测试用的设备中再进行后续的测试。而其中更新代码、构建整体系统这部分工作较为复杂，对于产品、测试人员来说不够友好。此外，构建环境本身的搭建也同样十分复杂，且构建环境对不同的目标平台无法实现隔离，非常不易于管理和维护。

### 1.2 项目研究目标

本文针对 1.1 节中提出的一系列问题，设计了一套构建工具。这套工具可以让用户以图形化的方式完成整个构建流程，使得用户可以非常轻松的完成上述组件更新以及系统构建的工作，提升工作效率；针对构建环境的运维问题，利用容器等技术对不同的构建环境进行隔离，区分管理。两者结合，使得项目开发综合效率得到显著提升。

### 1.3 本文工作和论文结构

本文主要介绍了这套自动构建系统的开发背景，以及设计和实现的工作，重点探讨了实际设计上的一些问题。

第一章讨论了本系统实现的背景以及期望达到的目标。

第二章介绍了本套系统设计上使用的一系列相关技术，包括 OpenWrt 嵌入式系统、OpenWrt 原构建系统的基础 Kbuild / Kconfig、管理构建环境时使用的 Docker 容器、搭建测试环境时使用的虚拟化相关技术、管理 OpenWrt 代码库以及厂商自有软件仓库使用的版本控制工具 Git，以及这套自动构建工具使用的 Web 后端框架 Django 以及前端框架 Bootstrap。

第三章介绍了本套系统的需求分析，包括可行性、功能性、可用性、安全性、性能等需求。

第四章介绍了整套系统的总体设计方案，包括整套系统的总体架构设计、对 OpenWrt 构建过程中一系列实体的抽象，以及 

----- 一个晚上写完这些，4.23

## 2 相关理论与技术
### 2.1 OpenWrt / LEDE
### 2.2 Kbuild 与 Kconfig
### 2.3 Docker
### 2.4 虚拟化
### 2.5 版本控制工具 Git
### 2.6 Django 与 Bootstrap

--- 选一个双休日写完这些，4.29 4.30

## 3 需求分析
### 3.1 可行性分析
#### 3.1.1 技术可行性
#### 3.1.2 经济可行性
#### 3.1.3 操作可行性
### 3.2 功能性需求
### 3.3 可用性需求
### 3.4 安全性需求
### 3.5 性能需求
### 3.6 本章小结

--- 两个晚上写完这些，4.24 4.25

## 4 设计方案
### 4.1 架构方案
### 4.2 仓库（Repository）
#### 4.2.1 普通仓库
#### 4.2.2 容器化管理的仓库
### 4.3 工作空间（Workspace）
### 4.4 构建 Worker
#### 4.4.1 普通的 Worker
#### 4.4.2 容器中的 Worker

--- 考虑到这两个应该都实现完了，4.26 一天晚上应该足够，不够的话跟下面的共享一天

### 4.5 测试环境
### 4.6 用户界面
#### 4.6.1 Kconfig 界面
#### 4.6.2 xterm 界面
#### 4.6.3 其他界面
### 4.7 本章小结

--- 考虑到 Kconfig 界面需要时间考虑怎么做，多分一段时间 4.27 4.28 4.29

## 5 具体实现
### 5.1 构建环境 Worker
#### 5.1.1 管理 Docker 容器
#### 5.1.2 更新 OpenWrt 代码
#### 5.1.3 管理 OpenWrt 软件源
#### 5.1.4 管理构建流程

--- 5.1 一整天

### 5.2 测试环境 Tester
### 5.3 用户界面 Manager
#### 5.3.1 Kconfig 界面
#### 5.3.2 xterm 界面
#### 5.3.3 普通的控制台回显界面
#### 5.3.4 其他的界面
### 5.4 本章小结

--- 还是 Kconfig 的问题，5.2 5.3 两天

## 6 测试与结果分析
### 6.1 开发环境及相关工具
### 6.2 测试环境与测试工具
### 6.3 测试用例与结果分析
#### 6.3.1 功能测试
#### 6.3.2 可用性测试
#### 6.3.3 安全性测试
#### 6.3.4 性能测试
### 6.4 本章小结
## 7 总结与展望
## 致谢
## 参考文献

--- 5.4 5.5 5.6 三个晚上尽量弄完这些吧

## 10000 字的英文翻译

--- 5.6 5.7 5.8 5.9 5.10 应该足够了，主题看 Kconfig 实现的情况，选择 Docker / Kbuild + Kconfig

# 后续：

* 5.8 - 5.10 公司工作交接 + 英文翻译 + 有时间的话去做查重

* 5.11 / 5.12 回学校，大概要办一些手续之类，舟车劳顿恐怕没时间
* 5.15 之前仍然查重收尾
